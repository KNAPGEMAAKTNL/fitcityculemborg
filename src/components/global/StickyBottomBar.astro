---
interface Props {
  ctaText?: string;
  ctaLink?: string;
}

const {
  ctaText = 'WORD NU LID',
  ctaLink = '/signup/'
} = Astro.props;
---

<div
  id="sticky-bottom-bar"
  class="fixed bottom-0 left-0 right-0 z-50 md:hidden glass-bar border-t border-white/10 pb-safe transition-transform duration-300"
  style="transform: translateY(100%);"
>
  <div class="px-4 py-3">
    <a
      href={ctaLink}
      class="btn-primary w-full text-center block"
    >
      {ctaText}
    </a>
  </div>
</div>

<style>
  .pb-safe {
    padding-bottom: max(0.75rem, env(safe-area-inset-bottom));
  }
</style>

<script>
  // Only show sticky bar when the target section (Vibe or Hero) is scrolled past
  document.addEventListener('DOMContentLoaded', () => {
    const stickyBar = document.getElementById('sticky-bottom-bar');
    // Prefer vibe-section, fallback to hero-section
    const targetSection = document.getElementById('vibe-section') || document.getElementById('hero-section');

    if (!stickyBar || !targetSection) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          // Show only if we've scrolled past the element (it's above viewport)
          // entry.boundingClientRect.top < 0 means the top of the element is above the viewport top
          // !entry.isIntersecting means it's not currently visible
          if (!entry.isIntersecting && entry.boundingClientRect.top < 0) {
            stickyBar.style.transform = 'translateY(0)';
          } else {
            stickyBar.style.transform = 'translateY(100%)';
          }
        });
      },
      {
        threshold: 0,
        rootMargin: '0px'
      }
    );

    observer.observe(targetSection);
  });
</script>
